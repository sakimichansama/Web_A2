<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Charity Event Management Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="tailwind.config.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gray-50 font-sans">
    <!-- Navigation Bar -->
    <nav id="navbar" class="bg-white shadow-md fixed w-full z-10 top-0"></nav>

    
    <header class="pt-24 pb-16 bg-gradient-to-r from-primary to-primary/80 text-white">
        <div class="container mx-auto px-4 md:px-6">
            <div class="max-w-3xl mx-auto text-center">
                <h1 class="text-4xl md:text-5xl font-bold mb-6 text-shadow">Let Love Be Passed On, Making the World Better</h1>
                <p class="text-xl md:text-2xl mb-8 opacity-90">Participate in our charity events and contribute to those in need</p>
                <a href="search.html" class="inline-block bg-white text-primary font-semibold px-8 py-3 rounded-full shadow-lg hover:shadow-xl transition duration-300">
                    Browse Events <i class="fa fa-arrow-right ml-2"></i>
                </a>
            </div>
        </div>
    </header>

    <!-- Mission Statement -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-4 md:px-6">
            <div class="max-w-3xl mx-auto text-center">
                <h2 class="text-3xl font-bold mb-6 text-dark">Our Mission</h2>
                <p class="text-lg text-gray-700 mb-8">
                    We are committed to connecting charitable organizations with caring individuals. Through various forms of charity events,
                    we raise funds for public welfare undertakings, enhance public awareness, and jointly create a more equitable
                    and better world.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="bg-gray-50 p-6 rounded-lg shadow">
                        <i class="fa fa-heart text-3xl text-primary mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2">Love Transmission</h3>
                        <p class="text-gray-600">Build bridges of love, allowing kindness to flow to every corner in need</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg shadow">
                        <i class="fa fa-handshake-o text-3xl text-primary mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2">Community Co-construction</h3>
                        <p class="text-gray-600">Gather community strength to jointly participate in public welfare undertakings</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg shadow">
                        <i class="fa fa-line-chart text-3xl text-primary mb-4"></i>
                        <h3 class="text-xl font-semibold mb-2">Sustainable Development</h3>
                        <p class="text-gray-600">Promote the sustainable development of public welfare and create long-term social value</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Upcoming Events -->
    <section class="py-16 bg-gray-50">
        <div class="container mx-auto px-4 md:px-6">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold mb-4 text-dark">Upcoming Events</h2>
                <p class="text-lg text-gray-600">Participate in these events to contribute to public welfare</p>
            </div>

            <div id="upcoming-events" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Events will be loaded dynamically via JavaScript -->
                <div class="col-span-full text-center py-16">
                    <i class="fa fa-circle-o-notch fa-spin text-4xl text-primary mb-4"></i>
                    <p class="text-lg text-gray-600">Loading events...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Past Events -->
    <section class="py-16 bg-white">
        <div class="container mx-auto px-4 md:px-6">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold mb-4 text-dark">Past Events</h2>
                <p class="text-lg text-gray-600">Review the charity events we have held</p>
            </div>

            <div id="past-events" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Events will be loaded dynamically via JavaScript -->
                <div class="col-span-full text-center py-16">
                    <i class="fa fa-circle-o-notch fa-spin text-4xl text-primary mb-4"></i>
                    <p class="text-lg text-gray-600">Loading events...</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Us -->
    <section class="py-16 bg-primary/10">
        <div class="container mx-auto px-4 md:px-6">
            <div class="max-w-3xl mx-auto text-center">
                <h2 class="text-3xl font-bold mb-6 text-dark">Contact Us</h2>
                <p class="text-lg text-gray-700 mb-8">If you have any questions or suggestions, please feel free to contact us</p>
                <div class="flex flex-col md:flex-row justify-center gap-6">
                    <div class="flex items-center">
                        <i class="fa fa-envelope text-primary text-xl mr-3"></i>
                        <span>contact@charityevents.org</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fa fa-phone text-primary text-xl mr-3"></i>
                        <span>+86 8848</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fa fa-map-marker text-primary text-xl mr-3"></i>
                        <span>Public Welfare Building, Chaoyang District, Beijing</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-dark text-white py-12">
        <div class="container mx-auto px-4 md:px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-semibold mb-4">Charity Event Platform</h3>
                    <p class="text-gray-400">Connecting love, passing warmth,and create a better future together</p>
                </div>
                <div>
                    <h3 class="text-xl font-semibold mb-4">Quick Links</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="index.html" class="hover:text-white transition">Home</a></li>
                        <li><a href="search.html" class="hover:text-white transition">Search Events</a></li>
                        <li><a href="#" class="hover:text-white transition">About Us</a></li>
                        <li><a href="#" class="hover:text-white transition">Frequency Asked Questions</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-xl font-semibold mb-4">Follow Us</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="bg-gray-700 hover:bg-primary w-10 h-10 rounded-full flex items-center justify-center transition">
                            <i class="fa fa-weixin"></i>
                        </a>
                        <a href="#" class="bg-gray-700 hover:bg-primary w-10 h-10 rounded-full flex items-center justify-center transition">
                            <i class="fa fa-weibo"></i>
                        </a>
                        <a href="#" class="bg-gray-700 hover:bg-primary w-10 h-10 rounded-full flex items-center justify-center transition">
                            <i class="fa fa-qq"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8 text-center text-gray-500">
                <p>&copy; 2025 Charity Event Management Platform. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // API base URL
        const API_BASE_URL = 'http://localhost:3000/api';

        // Load navigation bar
        function loadNavbar() {
            const navbar = document.getElementById('navbar');
            navbar.innerHTML = `
                <div class="container mx-auto px-4 md:px-6">
                    <div class="flex justify-between items-center h-16">
                        <div class="flex items-center">
                            <a href="index.html" class="flex items-center">
                                <i class="fa fa-heart text-primary text-2xl mr-2"></i>
                                <span class="font-bold text-xl text-dark">Charity Event Platform</span>
                            </a>
                        </div>
                        <div class="hidden md:block">
                            <div class="flex items-center space-x-8">
                                <a href="index.html" class="text-dark hover:text-primary font-medium transition">Home</a>
                                <a href="search.html" class="text-dark hover:text-primary font-medium transition">Search Events</a>
                                <a href="#" class="text-dark hover:text-primary font-medium transition">About Us</a>
                            </div>
                        </div>
                        <div class="md:hidden">
                            <button id="mobile-menu-button" class="text-gray-600 hover:text-primary">
                                <i class="fa fa-bars text-xl"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Mobile menu -->
                <div id="mobile-menu" class="hidden md:hidden bg-white shadow-lg">
                    <div class="px-2 pt-2 pb-3 space-y-1">
                        <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium text-dark hover:bg-primary hover:text-white">Home</a>
                        <a href="search.html" class="block px-3 py-2 rounded-md text-base font-medium text-dark hover:bg-primary hover:text-white">Search Events</a>
                        <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-dark hover:bg-primary hover:text-white">About Us</a>
                    </div>
                </div>
            `;

            // Mobile menu toggle
            document.getElementById('mobile-menu-button').addEventListener('click', () => {
                const mobileMenu = document.getElementById('mobile-menu');
                mobileMenu.classList.toggle('hidden');
            });
        }

        // Format date
        function formatDate(dateString) {
            if (!dateString) return 'Date not set';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return 'Invalid date';
            
            return date.toLocaleString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Calculate progress percentage
        function calculateProgress(current, target) {
            const currentNum = Number(current) || 0;
            const targetNum = Number(target) || 0;
            if (targetNum <= 0) return 0;
            return Math.min(Math.round((currentNum / targetNum) * 100), 100);
        }

        // Create event card
        function createEventCard(event) {
            if (!event) return '';
            
            const isPast = new Date(event.date) < new Date();
            const progress = calculateProgress(event.current_amount, event.target_amount);
            
            return `
                <div class="bg-white rounded-lg shadow overflow-hidden card-hover">
                    ${isPast ? '<div class="bg-gray-500 text-white text-center py-1 text-sm font-medium">Completed</div>' : ''}
                    <div class="relative h-48">
                        <img src="${event.image_url || 'https://picsum.photos/id/1060/800/400'}" alt="${event.name || 'Event image'}" class="w-full h-full object-cover">
                        <div class="absolute top-2 right-2 bg-primary text-white text-xs font-bold px-2 py-1 rounded">
                            ${event.category_name || 'Uncategorized'}
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-bold mb-2 text-dark">${event.name || 'Event name'}</h3>
                        <p class="text-gray-600 mb-4 line-clamp-2">${event.purpose || 'Event purpose'}</p>
                        
                        <div class="space-y-3 mb-4">
                            <div class="flex items-start">
                                <i class="fa fa-calendar text-primary mt-1 mr-3"></i>
                                <span class="text-gray-700">${formatDate(event.date)}</span>
                            </div>
                            <div class="flex items-start">
                                <i class="fa fa-map-marker text-primary mt-1 mr-3"></i>
                                <span class="text-gray-700">${event.location || 'Location not specified'}</span>
                            </div>
                            <div class="flex items-start">
                                <i class="fa fa-ticket text-primary mt-1 mr-3"></i>
                                <span class="text-gray-700">
                                    ${Number(event.ticket_price) > 0 ? `Ticket price: ¥${event.ticket_price}` : 'Free participation'}
                                </span>
                            </div>
                        </div>
                        
                        <!-- Fundraising progress -->
                        <div class="mb-4">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="font-medium">Fundraising progress</span>
                                <span class="text-gray-600">¥${(Number(event.current_amount) || 0).toFixed(2)} / ¥${(Number(event.target_amount) || 0).toFixed(2)}</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-secondary h-2 rounded-full" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        
                        <a href="event-details.html?id=${event.id}" class="block w-full text-center bg-primary text-white font-semibold py-2 rounded hover:bg-primary/90 transition">
                            View Details
                        </a>
                    </div>
                </div>
            `;
        }

        // Load event list
        async function loadEvents() {
            try {
                const response = await fetch(`${API_BASE_URL}/events`);
                if (!response.ok) {
                    throw new Error(`HTTP error: ${response.status}`);
                }
                
                const events = await response.json();
                if (!Array.isArray(events)) {
                    throw new Error('Data returned by API is not an array');
                }
                
                const upcomingEventsContainer = document.getElementById('upcoming-events');
                const pastEventsContainer = document.getElementById('past-events');
                
                // Clear loading state
                upcomingEventsContainer.innerHTML = '';
                pastEventsContainer.innerHTML = '';
                
                // Separate upcoming and past events
                const now = new Date();
                const upcomingEvents = events.filter(event => new Date(event.date) >= now);
                const pastEvents = events.filter(event => new Date(event.date) < now);
                
                // Display upcoming events
                if (upcomingEvents.length === 0) {
                    upcomingEventsContainer.innerHTML = `
                        <div class="col-span-full text-center py-16">
                            <i class="fa fa-calendar-o text-4xl text-gray-300 mb-4"></i>
                            <p class="text-lg text-gray-500">No upcoming events at the moment</p>
                        </div>
                    `;
                } else {
                    upcomingEvents.forEach(event => {
                        upcomingEventsContainer.innerHTML += createEventCard(event);
                    });
                }
                
                // Display past events
                if (pastEvents.length === 0) {
                    pastEventsContainer.innerHTML = `
                        <div class="col-span-full text-center py-16">
                            <i class="fa fa-history text-4xl text-gray-300 mb-4"></i>
                            <p class="text-lg text-gray-500">No historical event records</p>
                        </div>
                    `;
                } else {
                    pastEvents.forEach(event => {
                        pastEventsContainer.innerHTML += createEventCard(event);
                    });
                }
                
            } catch (error) {
                console.error('Failed to load events:', error);
                document.getElementById('upcoming-events').innerHTML = `
                    <div class="col-span-full text-center py-16">
                        <i class="fa fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <p class="text-lg text-gray-600">Failed to load events, please try again later</p>
                        <p class="text-sm text-gray-500 mt-2">Error message: ${error.message}</p>
                    </div>
                `;
                document.getElementById('past-events').innerHTML = '';
            }
        }

        // Execute after page load completes
        document.addEventListener('DOMContentLoaded', () => {
            loadNavbar();
            loadEvents();
        });
    </script>
</body>
</html>